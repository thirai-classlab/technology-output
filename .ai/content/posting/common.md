# 投稿共通ルール

## 最適化プロセス（4段階）

master.md + strategy.md（媒体別戦略）を入力として、4段階で媒体別コンテンツを生成する。

### Step 1: 構成最適化

strategy.md の媒体別戦略に基づき、セクションの追加・削除・順序変更を行う。

- 媒体ごとのペルソナに合わせてセクション構成を調整
- 不要なセクションの削除、媒体固有セクション（CTA、導入等）の追加
- 見出しレベルの制約に合わせて階層を調整（例: note は H2/H3 のみ）

### Step 2: コンテンツ最適化

媒体の読者層・技術深度に合わせて、内容の深さ・具体例・文体を調整する。

- strategy.md で指定されたトーンに変換
- 技術深度の調整（初心者向け補足追加 or 上級向け詳細追加）
- 媒体特性に合わせた説明の追加・省略

### Step 3: フォーマット最適化

各媒体のフォーマット対応状況に基づき、Markdown記法・独自記法に変換する。

- 下記「フォーマット互換マトリクス」に従い、非対応要素を代替表現に変換
- 各媒体の独自記法（Qiita Note記法、Zenn メッセージブロック等）を活用
- コードブロック・Mermaid・数式の媒体別制約を遵守

### Step 4: エンゲージメント最適化

CTA・リード文・タグ・SEO要素など、読者行動を促す要素を追加する。

- frontmatter（Zenn）、SEOメタ（WordPress）、タグ（Qiita/Zenn）
- CTA（note/WordPress）、参考リンク（Qiita/Zenn）
- 社内向け補足（社内Git）、クロスリンク

---

## フォーマット互換マトリクス

各媒体のフォーマット対応状況。変換時にこの表を参照して非対応要素を処理する。

| 要素 | note | Qiita | Zenn | WordPress | 社内Git |
|------|------|-------|------|-----------|---------|
| 見出し | H2, H3のみ | H1-H6 | H1-H6（H2から推奨） | H2-H4（テーマ対応） | H1-H6 |
| 太字 | 対応 | 対応 | 対応 | 対応 | 対応 |
| 斜体 | 非対応 | 対応 | 対応 | 対応 | 対応 |
| 取り消し線 | 対応 | 対応 | 対応 | 対応 | 対応 |
| テーブル | 非対応 | 対応（配置指定可） | 対応（配置指定可） | 対応（テーマCSS） | 対応（配置指定可） |
| コードブロック | 対応（ハイライト可） | 対応（200+言語） | 対応（Shiki 208言語） | 対応（Prism.js 12言語） | 対応（Linguist） |
| コード ファイル名 | 非対応 | 対応（`:filename`） | 対応（`:filename`） | 対応（`data-lang`） | 非対応 |
| Diff表示 | 非対応 | 対応（`diff_lang`） | 対応（`diff lang`） | 対応（Prism diff） | 対応（`diff`） |
| Mermaid | 対応 | 対応（2000字制限） | 対応（2000字制限） | 対応（テーマ対応） | 対応 |
| 数式 | KaTeX対応 | LaTeX対応 | KaTeX対応 | 非対応 | MathJax対応 |
| 脚注 | 非対応 | 対応 | 対応 | 非対応 | 対応 |
| 折りたたみ | 非対応 | 対応（`<details>`） | 対応（`:::details`） | 対応（`[accordion]`） | 対応（`<details>`） |
| 注釈ブロック | 非対応 | 対応（`:::note`） | 対応（`:::message`） | 対応（`[note]`等） | 対応（`[!NOTE]`等） |
| 画像サイズ指定 | 非対応 | HTMLタグで可 | `=250x` 記法 | HTMLタグで可 | HTMLタグで可 |
| 埋め込み | 多数（URL貼付） | 多数（URL/iframe） | `@[service](URL)` | 自由（HTML） | 非対応 |
| frontmatter | なし | なし | YAML必須 | SEOコメント | なし |
| 目次 | 手動挿入 | 自動生成 | 自動生成 | 自動生成（テーマ） | TOCボタン |
| 文字数上限 | 実質無制限 | 200万字 | 8万字 | 実質無制限 | 512KB |

### 非対応要素の変換ルール

| 元の要素 | note での代替 | WordPress での代替 |
|----------|--------------|-------------------|
| テーブル | 箇条書き or KaTeX配列 or 画像 | HTMLテーブル（テーマCSS対応） |
| 斜体 | 太字で代替 | `<em>` タグ |
| 脚注 | 本文中に括弧書き | 本文中に括弧書き |
| 折りたたみ | セクション分割 | `[accordion]` ショートコード |
| 注釈ブロック | 引用ブロック（`>`）で代替 | `[note]`/`[warning]` ショートコード |
| 数式 | KaTeX対応（そのまま） | 画像に変換 or テキスト表記 |
| H4以下の見出し | 太字テキストで代替 | H4対応（テーマCSS） |

---

## トーン

| 媒体 | トーン | 特徴 |
|------|--------|------|
| note | エッセイ調 | 語りかけるような文体、体験・ストーリー性を加える |
| Qiita | 技術記事調 | ですます体、客観的、根拠を添える |
| Zenn | 技術記事調 | ですます体、Qiitaに近いがZenn独自記法を活用 |
| WordPress | SEO記事調 | ですます体、検索意図を意識した見出し |
| 社内Git | フラット技術文書調 | である体OK、社内コンテキスト前提 |

## 構造の調整

| 媒体 | 冒頭 | 末尾 | 固有の追加要素 |
|------|------|------|---------------|
| note | リード文（課題提示＋得られること） | まとめ＋CTA | 目次（手動挿入） |
| Qiita | 対象読者＋得られること | 参考リンク | タグ（最大5つ）、Note記法 |
| Zenn | 概要 | 参考リンク | frontmatter、メッセージブロック |
| WordPress | リード文（SEO意識） | CTA＋関連記事リンク | SEOメタ情報、カテゴリ・タグ |
| 社内Git | そのまま | そのまま | 社内向け補足、Alerts |

---

## 画像管理

- 画像はWordPressのメディアライブラリをマスターストレージとする
- MCPでWordPressにアップロードし、取得したURLを全媒体で共通参照する
- 画像のアップロードはCONVERTフェーズの最初に行う
- 詳細は `.ai/content/posting/images.md` を参照

## 変換の実行手順

1. strategy.md の「媒体別戦略」セクションを読み、投稿対象の媒体と各媒体の戦略を確認
2. `.ai/content/posting/common.md`（本ファイル）+ 各媒体ルールを読み込み
3. 画像があればWordPressにアップロードし、images.md にURL記録
4. 4段階最適化プロセスに従い、各媒体版を生成:
   - Step 1: 構成最適化（媒体別戦略の構成変更点を反映）
   - Step 2: コンテンツ最適化（トーン・深度・文体を調整）
   - Step 3: フォーマット最適化（互換マトリクスに従い記法変換）
   - Step 4: エンゲージメント最適化（CTA・タグ・SEO等を追加）
5. `platforms/{媒体名}.md` として出力

## 投稿ツール

| 媒体 | ツール | 種別 |
|------|--------|------|
| note | scripts/post-note.py | API |
| Qiita | qiita-cli | CLI |
| Zenn | zenn-cli | CLI |
| WordPress | wordpress-mcp | MCP |
| 社内Git | GitHub MCP | MCP |
| 社内展開 | Slack MCP | MCP |

## 投稿フロー

1. 各ツールで下書きとして投稿
2. 人間が各媒体上で下書きを確認
3. 修正があればCONVERTに戻る
4. 人間の公開承認を得る
5. 各ツールで公開
6. 投稿URLをtrack.mdに記録
7. クロスリンクを各記事に追記
8. Slack MCPで社内に展開

## 投稿順序

WordPress → Qiita → Zenn → note → 社内Git → Slack展開

- WordPressを最初に投稿（画像マスター + SEOインデックス先行）
- 社内Gitは外部URLが揃ってからクロスリンク付きで投稿
- Slack展開は全媒体の公開完了後
