# ルール追加コマンド

新しいルールをプロジェクトに追加し、既存コンテンツの違反チェックと改善を行う。

## 手順

### Step 1: ルールの受け取り
ユーザーから追加したいルールの内容を受け取る。引数 `$ARGUMENTS` が指定されている場合はそれをルールとして使用する。未指定の場合はチャットで確認する。

### Step 2: ドメインとカテゴリのヒアリング
まずドメインを確認する:

| ドメイン | パス | 用途 |
|----------|------|------|
| **dev** | `.ai/dev/` | プロジェクト開発ルール（構造・コマンド・設計資料など） |
| **content** | `.ai/content/` | 記事投稿ルール（ワークフロー各Phase） |

ドメインが `content` の場合、さらにカテゴリを確認する:

| カテゴリ | パス | 用途 |
|----------|------|------|
| brainstorm | `.ai/content/brainstorm/` | 探索・ブレスト時のルール |
| strategy | `.ai/content/strategy/` | 戦略策定時のルール |
| writing | `.ai/content/writing/` | 執筆時のルール |
| review | `.ai/content/review/` | レビュー時のルール |
| posting | `.ai/content/posting/` | 媒体変換・投稿時のルール |
| track | `.ai/content/track/` | 反響管理時のルール |

サブカテゴリ（ファイル名）も確認する。既存ファイルへの追記か、新規ファイル作成かを判断する。

### Step 3: ルールファイルの作成・更新
- 既存ファイルがあれば該当セクションに追記する
- 新規の場合は `.ai/{ドメイン}/{カテゴリ}/{サブカテゴリ}.md` を作成する
- ルールは箇条書きで明確に記述する

### Step 4: CLAUDE.md の更新
- CLAUDE.md のルール管理セクションを確認する
- 新しいカテゴリやファイルが追加された場合、CLAUDE.md のルール一覧を更新する

### Step 5: プロジェクト内の違反チェック
- プロジェクト内の関連ファイルを走査する
  - `dev` ルール → プロジェクト構造・設定ファイル・コマンド等を対象
  - `content` ルール → `posts/` ディレクトリ以下を対象
- 追加されたルールに照らして違反箇所を特定する
- 違反がない場合はその旨を報告して終了する

### Step 6: 違反の改善提案
- 各違反について、具体的な改善案をチャットで提示する
- ファイル名・該当箇所・現状・改善案を明示する

### Step 7: 改善の実施
- ユーザーの承認を得てから改善を実施する
- 改善内容をファイルに反映する
- 改善完了後、再度違反チェックを行い問題がないことを確認する
